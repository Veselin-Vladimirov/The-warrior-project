// Define the analog pin to which the anemometer is connected
const int anemometerPin = 32;  // Change this to your desired analog pin

void setup() {
  // Initialize Serial Monitor
  Serial.begin(115200);
}

void loop() {
  // Read the voltage from the anemometer pin
  int sensorValue = analogRead(anemometerPin);
  
  // Convert the analog value to voltage (0-5V range)
  float voltage = sensorValue * (5.0 / 4095.0); // ESP32 ADC is 12-bit, hence 4095

  // Calculate wind speed
  float windSpeed = calculateWindSpeed(voltage);

  // Print the wind speed
  Serial.print("Wind Speed: ");
  Serial.print(windSpeed);
  Serial.println(" m/s");

  // Add some delay before the next reading
  delay(100);
}

// Function to calculate wind speed from voltage
float calculateWindSpeed(float voltage) {
    // Define the calibration parameters
    float voltageAtZeroWind = 0.0; // Voltage output at zero wind speed
    float voltageAtMaxWind = 5.0;  // Voltage output at maximum wind speed
    float maxWindSpeed = 45.0;    // Maximum wind speed in your measurement unit (e.g., mph)

    // Calculate the slope (change in wind speed per unit change in voltage)
    float slope = maxWindSpeed / (voltageAtMaxWind - voltageAtZeroWind);

    // Calculate the wind speed using linear interpolation
    float windSpeed = slope * (voltage - voltageAtZeroWind);

    // Ensure wind speed is within the valid range
    windSpeed = constrain(windSpeed, 0, maxWindSpeed);

    return windSpeed;
}
